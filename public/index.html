<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculator</title>
  <style>
    body {
      background-color: #c5eef3;
    }

    .result {
      display: flex;
      align-items: center;
    }

    .barbel {
      width: 130px;
      height: 25px;
      background-color: #8a2be2;
      color: #f1f1f1;
      border: 1px solid #333;
      text-align: center;
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .plate {
      width: 30px;
      width: fit-content;
      padding: 5px;
      height: 60px;
      background-color: #f5f5dc;
      border: 1px solid #333;
      text-align: center;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>

<body>
  <div class="container">
    <form class="form">
      <div class="mode">

        <label for="mode">Mode: </label>
        <select id="mode" name="mode" form="form" onchange="getval(this)">
          <option value="single">Single</option>
          <option value="range">Range</option>
        </select><br>
      </div>

      <div class="single">
        <label for="target">Target weight (kg): </label>
        <input id="target" min="15" step="0.5" type="number" autofocus required value="126.5"></input><br>
      </div>

      <div class="range">
        <label for="from">From (kg): </label>
        <input id="from" min="15" step="0.5" type="number" autofocus></input><br>

        <label for="to">To (kg): </label>
        <input id="to" min="15" step="0.5" type="number" autofocus></input><br>
      </div>

      <label for="barbels">Barbels: </label>
      <input type="checkbox" id="barbel15" name="barbels" value="15" checked>
      <label for="barbel15">15 kg</label>
      <input type="checkbox" id="barbel20" name="barbels" value="20">
      <label for="barbel20">20 kg</label><br>

      <label for="plates">Plates: </label><br>
      <label for="025">0.25 kg:</label>
      <input id="025" type="number" step="1" min="0" name="plates" required></input><br>
      <label for="05">0.5 kg:</label>
      <input id="05" type="number" step="1" min="0" name="plates" required></input><br>
      <label for="1">1 kg:</label>
      <input id="1" type="number" step="1" min="0" name="plates" required></input><br>
      <label for="2">2 kg:</label>
      <input id="2" type="number" step="1" min="0" name="plates" required></input><br>
      <label for="5">5 kg:</label>
      <input id="5" type="number" step="1" min="0" name="plates" required></input><br>
      <label for="10">10 kg:</label>
      <input id="10" type="number" step="1" min="0" name="plates" required></input><br>
      <label for="15">15 kg:</label>
      <input id="15" type="number" step="1" min="0" name="plates" required></input><br>
      <label for="20">20 kg:</label>
      <input id="20" type="number" step="1" min="0" name="plates" required></input><br>
      <label for="25">25 kg:</label>
      <input id="25" type="number" step="1" min="0" name="plates" required></input><br>

      <button id="submit" type="button">Calculate</button>

    </form>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script type="application/javascript">
    const MODES = Object.freeze({
      single: 'single',
      range: 'range',
    })
    let mode = ''
    let barbels = []
    let plates = []
    let result = {}

    setup()

    $(document).on('keypress', handlePressEnter)
    $('input[name="barbels"]').on('keypress', handlePressEnter)
    $('input[name="plates"]').on('keypress', handlePressEnter)

    $('input[name="barbels"]').on('click', handleBarbels)

    $('input[name="plates"]').on('change', handlePlates)

    $("#submit").on("click", submit)

    function setup() {
      mode = MODES.single
      barbels = [15]
      plates = [[25, 0], [20, 2], [15, 2], [10, 2], [5, 2], [2, 4], [1, 2], [0.5, 2], [0.25, 0]]

      plates.forEach((plate, index) => {
        $(`#${genId(plate[0])}`).val(plate[1])
      })

      genWeightInput(MODES.single)
    }

    function handlePressEnter(e) {
      if (e.which == 13) {
        submit(e)
      }
    }

    function getval(sel) {
      mode = $("#mode option:selected").val()
      genWeightInput(mode)
    }

    function genWeightInput(mode) {
      if (mode === MODES.single) {
        $('.range').css('opacity', '0')
        $('.single').css('opacity', '1')
        return
      }

      if (mode === MODES.range) {
        $('.range').css('opacity', '1')
        $('.single').css('opacity', '0')
        return
      }
    }

    function handleBarbels(e) {
      const target = e.currentTarget
      const val = Number($(target).val() || 0)

      if ($(target).is(':checked')) {
        if (val && !barbels.includes(val)) {
          barbels.push(val)
          barbels = barbels.sort()
        }
      } else {
        barbels = barbels.filter(item => item !== val)
      }
    }

    function handlePlates(e) {
      const target = e.currentTarget
      const val = Number($(target).val() || 0)
      const id = $(target).attr('id')
      const index = plates.findIndex(plate => genId(plate[0]) === id)
      plates[index][1] = val
    }

    function submit(e) {
      e.preventDefault()

      $(`.result`).remove()

      const mode = $('#mode').val()

      if (mode === MODES.range) {
        const from = Number($("#from").val())
        const to = Number($("#to").val())
        for (let i = from; i <= to; i++) {
          const result = calculate(i, barbels, plates)
          genUI(result, i)
        }
      } else if (mode === MODES.single) {
        const target = Number($('#target').val())
        const result = calculate(target, barbels, plates)
        genUI(result)
      }
    }

    function calculate(target, barbels, plates) {
      const result = []

      if (!target || !barbels || !plates || barbels.length === 0) {
        return result
      }

      let holder = target

      barbels.every(barbel => {
        if (barbel <= target) {
          holder -= barbel
          result.push([barbel, 1])
          return false
        }
        return true
      })

      if (holder === target) return result

      plates.forEach(plate => {
        const weight = plate[0]
        let amount = 0

        while (amount <= plate[1] - 2 && holder >= weight * 2) {
          holder -= weight * 2
          amount += 2
        }

        if (amount) {
          result.push([weight, amount])
        }
      })

      if (holder === 0) return result

      return []
    }

    function genUI(result, index = 0) {
      const classname = `result${index}`
      $('.container').append(`<div class="result ${classname}"></div>`)

      if (result.length === 0) {
        $(`.${classname}`).append($('<div class="empty">No result</div>'))
        return
      }

      result.forEach((item, i) => {
        const weight = item[0]
        let amount = item[1]

        while (amount >= 1) {
          amount -= i === 0 ? 1 : 2
          const $div = $("<div>", {
            class: i === 0 ? `barbel barbel${weight}` : `plate plate${weight}-${i}`,
            css: { "height": i === 0 ? '' : genHeight(weight) },
            text: weight,
          })
          $(`.${classname}`).append($div)
        }
      })
    }

    function genHeight(weight) {
      if (weight >= 10) return weight * 9
      if (weight === 0.25) return weight * 65
      if (weight === 0.5) return weight * 45
      if (weight === 1) return weight * 35
      if (weight === 2) return weight * 25
      return weight * 13
    }

    function genId(weight) {
      return String(weight).replace('.', '')
    }
  </script>
</body>

</html>