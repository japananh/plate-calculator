<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <style>
    body {
      background-color: #c5eef3;
    }

    .result {
      display: flex;
      align-items: center;
    }

    .barbel {
      width: 130px;
      height: 25px;
      background-color: #8a2be2;
      color: #f1f1f1;
      border: 1px solid #333;
      text-align: center;
      border-radius: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .plate {
      width: 30px;
      width: fit-content;
      padding: 5px;
      height: 60px;
      background-color: #f5f5dc;
      border: 1px solid #333;
      text-align: center;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>

<body>
  <div class="container my-2">
    <form>
      <div id="mode" class="mb-3">
        <label for="mode"><b>Mode:</b></label>
        <div class="form-check d-inline-block mx-2">
          <input class="form-check-input" type="radio" id="input-single" name="mode" value="single" checked>
          <label for="input-single" class="form-check-label">Single</label>
        </div>
        <div class="form-check d-inline-block">
          <input class="form-check-input" type="radio" id="input-range" name="mode" value="range">
          <label for="input-range" class="form-check-label">Range</label><br>
        </div>
      </div>

      <div class="mb-3">
        <label for="barbels"><b>Barbels:</b></label>
        <div class="form-check d-inline-block mx-2">
          <input class="form-check-input" type="checkbox" id="barbel15" name="barbels" value="15" checked>
          <label for="barbel15" class="form-check-label">15 kg</label>
        </div>
        <div class="form-check d-inline-block">
          <input class="form-check-input" type="checkbox" id="barbel20" name="barbels" value="20">
          <label for="barbel20" class="form-check-label">20 kg</label><br>
        </div>
      </div>

      <div class="mb-3">
        <label for="plates" class="mb-2"><b>Plates:</b></label><br>

        <div class="input-group input-group-sm mb-1">
          <label for="025" class="input-group-text">0.25 kg</label>
          <input id="025" class="form-control" type="number" step="1" min="0" name="plates" required></input><br>
        </div>

        <div class="input-group input-group-sm mb-1">
          <label for="05" class="input-group-text">0.5 kg</label>
          <input id="05" class="form-control" type="number" step="1" min="0" name="plates" required></input><br>
        </div>

        <div class="input-group input-group-sm mb-1">
          <label for="1" class="input-group-text">1 kg</label>
          <input id="1" class="form-control" type="number" step="1" min="0" name="plates" required></input><br>
        </div>

        <div class="input-group input-group-sm mb-1">
          <label for="2" class="input-group-text">2 kg</label>
          <input id="2" class="form-control" type="number" step="1" min="0" name="plates" required></input><br>
        </div>

        <div class="input-group input-group-sm mb-1">
          <label for="5" class="input-group-text">5 kg</label>
          <input id="5" class="form-control" type="number" step="1" min="0" name="plates" required></input><br>
        </div>

        <div class="input-group input-group-sm mb-1">
          <label for="10" class="input-group-text">10 kg</label>
          <input id="10" class="form-control" type="number" step="1" min="0" name="plates" required></input><br>
        </div>

        <div class="input-group input-group-sm mb-1">
          <label for="15" class="input-group-text">15 kg</label>
          <input id="15" class="form-control" type="number" step="1" min="0" name="plates" required></input><br>
        </div>

        <div class="input-group input-group-sm mb-1">
          <label for="20" class="input-group-text">20 kg</label>
          <input id="20" class="form-control" type="number" step="1" min="0" name="plates" required></input><br>
        </div>

        <div class="input-group input-group-sm mb-1">
          <label for="25" class="input-group-text">25 kg</label>
          <input id="25" class="form-control" type="number" step="1" min="0" name="plates" required></input><br>
        </div>
      </div>

      <button class="btn btn-primary" id="submit" type="button">Calculate</button>

    </form>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script type="application/javascript">
    const MODES = Object.freeze({
      single: 'single',
      range: 'range',
    })
    let mode = ''
    let barbels = []
    let plates = []
    let result = {}

    setup()

    $(document).on('keypress', handlePressEnter)
    $('input[name="mode"]').on('keypress', handlePressEnter)
    $('input[name="barbels"]').on('keypress', handlePressEnter)
    $('input[name="plates"]').on('keypress', handlePressEnter)

    $('input[name="mode"]').on('click', handleMode)
    $('input[name="barbels"]').on('click', handleBarbels)
    $('input[name="plates"]').on('change', handlePlates)

    $("#submit").on("click", submit)

    function setup() {
      mode = MODES.single
      barbels = [15]
      plates = [[25, 0], [20, 2], [15, 2], [10, 2], [5, 2], [2, 4], [1, 2], [0.5, 2], [0.25, 0]]

      genWeightInput(mode)

      plates.forEach((plate, index) => {
        $(`#${genId(plate[0])}`).val(plate[1])
      })
    }

    function handlePressEnter(e) {
      if (e.which == 13) {
        submit(e)
      }
    }

    function genWeightInput(mode) {
      const $singleDiv = `<div class="single mb-3 input-group input-group-sm">
        <label for="target" class="input-group-text">Target weight (kg): </label>
        <input id="target" class="form-control" min="15" step="0.5" type="number" autofocus required></input><br>
      </div>`

      const $rangeDiv = `<div class="range mb-3">
        <div class="input-group input-group-sm mb-1">
          <label for="from" class="input-group-text">From (kg) </label>
          <input id="from" class="form-control" min="15" step="0.5" type="number" autofocus required></input><br>
        </div>

        <div class="input-group input-group-sm mb-1">
          <label for="to" class="input-group-text">To (kg) </label>
          <input id="to" class="form-control" min="15" step="0.5" type="number" autofocus required></input><br>
        </div>
      </div>`

      const $el = $('#mode')

      if (mode === MODES.single) {
        $('.single').remove()
        $('.range').remove()
        $el.after($singleDiv)
        return
      }

      if (mode === MODES.range) {
        $('.single').remove()
        $('.range').remove()
        $el.after($rangeDiv)
        return
      }
    }

    function handleMode(e) {
      const target = e.currentTarget

      if ($(target).is(':checked')) {
        mode = $(target).val()
        genWeightInput(mode)
      }
    }

    function handleBarbels(e) {
      const target = e.currentTarget
      const val = Number($(target).val() || 0)

      if ($(target).is(':checked')) {
        if (val && !barbels.includes(val)) {
          barbels.push(val)
          barbels = barbels.sort((a, b) => b - a)
        }
      } else {
        barbels = barbels.filter(item => item !== val)
      }
    }

    function handlePlates(e) {
      const target = e.currentTarget
      const val = Number($(target).val() || 0)
      const id = $(target).attr('id')
      const index = plates.findIndex(plate => genId(plate[0]) === id)
      plates[index][1] = val
    }

    function submit(e) {
      e.preventDefault()

      $('.result').remove()

      if (mode === MODES.range) {
        const from = Number($("#from").val())
        const to = Number($("#to").val())
        let invalidList = []
        for (let i = from; i <= to; i++) {
          const result = calculate(i, barbels, plates)
          if (result.length === 0) invalidList.push(i)
        }
        genInvalidResult(invalidList)
      } else if (mode === MODES.single) {
        const target = Number($('#target').val())
        const result = calculate(target, barbels, plates)
        genUI(result)
      }
    }

    function calculate(target, barbels, plates) {
      const result = []

      if (!target || !barbels || !plates || barbels.length === 0) {
        return result
      }

      let holder = target

      barbels.every(barbel => {
        if (barbel <= target) {
          holder -= barbel
          result.push([barbel, 1])
          return false
        }
        return true
      })

      if (holder === target) return result

      plates.forEach(plate => {
        const weight = plate[0]
        let amount = 0

        while (amount <= plate[1] - 2 && holder >= weight * 2) {
          holder -= weight * 2
          amount += 2
        }

        if (amount) {
          result.push([weight, amount])
        }
      })

      if (holder === 0) return result

      return []
    }

    function genUI(result) {
      const classname = 'result'

      if (result.length === 0) {
        $('.container').append(`<div class="${classname} mt-3 text-danger">Cannot calculate result from your plates!</div>`)
        return
      }

      $('.container').append(`<div class="${classname} mt-3"></div>`)

      result.forEach((item, i) => {
        const weight = item[0]
        let amount = item[1]

        while (amount >= 1) {
          amount -= i === 0 ? 1 : 2
          const $div = $("<div>", {
            class: i === 0 ? `barbel barbel${weight}` : `plate plate${weight}-${i}`,
            css: { "height": i === 0 ? '' : genHeight(weight) },
            text: weight,
          })
          $(`.${classname}`).append($div)
        }
      })
    }

    function genInvalidResult(invalidList) {
      if (invalidList.length === 0) {
        return $('.container').append(`<div class="result mt-3 .text-success">No weight cannot be calculated. Great jobs!</div>`)
      }
      $('.container').append(`
        <div class="result mt-3 d-block">
          These <b>${invalidList.length}</b> weights can not be calculated:
          <div class="text-secondary">${invalidList.join(', ')}</div>
        </div>`)
    }

    function genHeight(weight) {
      if (weight >= 10) return weight * 9
      if (weight === 0.25) return weight * 65
      if (weight === 0.5) return weight * 45
      if (weight === 1) return weight * 35
      if (weight === 2) return weight * 25
      return weight * 13
    }

    function genId(weight) {
      return String(weight).replace('.', '')
    }
  </script>
</body>

</html>